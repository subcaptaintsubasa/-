<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>データベース救出ツール</title>
    <link rel="stylesheet" href="css/admin-base.css">
    <link rel="stylesheet" href="css/admin-forms.css">
    <style>
        body { background-color: #fbeaea; }
        .restore-container { max-width: 800px; margin: 50px auto; padding: 40px; background-color: #fff; border: 2px solid #dc3545; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .warning-box { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 20px; border-radius: 5px; margin-bottom: 25px; }
        .warning-box h3 { margin-top: 0; color: #721c24; }
        .progress-area { margin-top: 20px; font-family: monospace; font-size: 0.9em; background-color: #212529; color: #f8f9fa; padding: 15px; border-radius: 4px; height: 400px; overflow-y: scroll; white-space: pre-wrap; }
        #rescueButton { background-color: #dc3545; font-size: 1.2em; padding: 15px; width: 100%; }
        #rescueButton:hover { background-color: #c82333; }
        #rescueButton:disabled { background-color: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body id="admin-page">
    <div id="password-prompt">
        <h2>救出ツール ログイン</h2>
        <p style="color: #f8d7da; max-width: 320px; text-align: center; margin-bottom: 15px;">これは緊急用のツールです。マスター管理者のみが操作してください。</p>
        <input type="email" id="adminEmailInput" placeholder="メールアドレス" autocomplete="email">
        <input type="password" id="adminPasswordInput" placeholder="パスワード" autocomplete="current-password">
        <button id="loginButton" type="button">ログイン</button>
        <p id="passwordError" class="error-message"></p>
    </div>

    <div id="restore-content" class="restore-container" style="display:none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>データベース救出ツール</h1>
            <button id="logoutButton" type="button">ログアウト</button>
        </div>
        
        <div class="warning-box">
            <h3><span class="icon">🚨</span>【最重要・最終警告】</h3>
            <p>このツールは、IDの関連性が失われたデータベースを、古いバックアップファイルを使って修復する**最終手段**です。</p>
            <ul>
                <li>現在のデータベースを**完全に削除**し、修復したデータで上書きします。</li>
                <li>**IDが壊れる前の、古い形式のバックアップJSONファイル**（`version: "1.0"`のもの）を選択してください。</li>
                <li>この操作は一度しか行えません。失敗は許されません。</li>
            </ul>
        </div>

        <div class="form-group">
            <label for="backupFile">**IDが壊れる前**のバックアップファイル (.json) を選択してください:</label>
            <input type="file" id="backupFile" accept="application/json,.json">
        </div>

        <div class="form-group">
            <label for="confirmText">上記の警告をすべて理解し、救出を実行する場合は、以下のボックスに「RESCUE MY DATA」と入力してください:</label>
            <input type="text" id="confirmText" placeholder="RESCUE MY DATA">
        </div>

        <button id="rescueButton" type="button" disabled>救出を実行</button>

        <div id="progressArea" class="progress-area" style="display: none;"></div>
    </div>

    <script type="module" src="js/restore.js"></script>

</body>
</html>
